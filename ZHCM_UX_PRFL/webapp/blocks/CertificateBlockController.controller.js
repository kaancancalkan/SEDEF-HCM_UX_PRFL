/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["com/sedef/hcm/ux/myprofile/controller/BaseController","com/sedef/hcm/ux/myprofile/utils/reuseHandler","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","com/sedef/hcm/ux/myprofile/utils/formatter"],function(e,t,i,o,r,a){"use strict";return e.extend("com.sedef.hcm.ux.myprofile.blocks.CertificateBlockController",{reuseHandler:t,formatter:a,onInit:function(){this.oApplicationController=t.getOwnerComponent().getModel("appProperties").getProperty("/applicationController");this.oODataModel=t.getOwnerComponent().getModel();var e=new r({changeRequest:{},editRequest:false,busy:false});this.setModel(e,"certificateModel");var i=sap.ui.getCore().getEventBus();i.subscribe("Certificate","Create",this.onAddCertificate,this)},onAddCertificate:function(){var e=this;var t=this.getModel("certificateModel");t.setProperty("/editRequest",false);t.setProperty("/changeRequest",{CertificateIndefinite:false,CertificateEnd:null});var i=sap.ui.getCore().byId("idCertificateChangeRequestDialog");if(i){i.destroy()}e._oCertificateDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.CertificateChangeRequest",e);e.getView().addDependent(e._oCertificateDialog);e._oCertificateDialog.open()},onBeforeDialogOpen:function(){},onCloseDialog:function(){if(this._oCertificateDialog){this._oCertificateDialog.close()}},onAfterDialogClose:function(){this._oCertificateDialog.destroy();delete this._oCertificateDialog},onSaveChange:function(){var e=this;var r=t.getOwnerComponent().getModel("appProperties");var a=this.getModel("certificateModel");var n=this.getModel();var s=a.getProperty("/editRequest");var c={Operation:s?"MOD":"INS",OperationId:Date.now().toString(),EntityName:"Certificate",toCertificate:_.cloneDeep(a.getProperty("/changeRequest")),toReturn:{}};if(!s){c.toCertificate.EmployeeNumber=r.getProperty("/employeeId")}if(!c.toCertificate.BeginDate){c.toCertificate.BeginDate=c.toCertificate.CertificateDate;c.toCertificate.EndDate=new Date("9999-12-31")}if(c.toCertificate.CertificateIndefinite){c.toCertificate.CertificateEnd=new Date("9999-12-31")}else{if(!c.toCertificate.CertificateEnd){c.toCertificate.CertificateEnd=c.toCertificate.CertificateDate}}c.toCertificate.BeginDate.setHours(9);c.toCertificate.CertificateDate.setHours(9);c.toCertificate.CertificateEnd.setHours(9);c.toCertificate.EndDate.setHours(9);e.setBusy(true);n.create("/InfotypeOperationSet",c,{success:function(t){if(t.toReturn.Type==="E"){o.error(t.toReturn.Message)}else{i.show("Kayıt başarılı");e._refreshProfileView()}e.setBusy(false)},error:function(t){e.setBusy(false);jQuery.sap.log.error(t)}})},onDeleteRecord:function(e){var t=e.getSource();var r=t.getBindingContext().getObject();var a=this;var n=this.getModel();var s=function(){var e={Operation:"DEL",OperationId:Date.now().toString(),EntityName:"Certificate",toCertificate:_.cloneDeep(r),toReturn:{}};e.toCertificate.BeginDate.setHours(9);e.toCertificate.EndDate.setHours(9);a.setBusy(true);n.create("/InfotypeOperationSet",e,{success:function(e){if(e.toReturn.Type==="E"){o.error(e.toReturn.Message)}else{i.show("Kayıt silme başarılı");a._refreshProfileView()}a.setBusy(false)},error:function(e){a.setBusy(false);jQuery.sap.log.error(e)}})};var c=new sap.m.Dialog({title:"Silme Onayı",type:"Message",state:"Warning",content:new sap.m.VBox({items:[new sap.m.Text({text:"Bu işlem sonucunda kayıt silinecektir."}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Text({text:"Devam etmek istiyor musunuz?"})]}),beginButton:new sap.m.Button({type:sap.m.ButtonType.Reject,text:"Sil",press:function(){s();c.close()}}),endButton:new sap.m.Button({text:"İptal",press:function(){c.close()}}),afterClose:function(){c.destroy()}});c.open()},onEditRecord:function(e){var t=e.getSource();var i=t.getBindingContext().getObject();var o=this.getModel("certificateModel");var r=this;o.setProperty("/editRequest",true);o.setProperty("/changeRequest",_.cloneDeep(i));r._oCertificateDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.CertificateChangeRequest",r);r.getView().addDependent(r._oCertificateDialog);r._oCertificateDialog.open()},setBusy:function(e){var t=this.getModel("certificateModel");t.setProperty("/busy",e)},onCertificateDateSwitched:function(){},_refreshProfileView:function(){var e=t.getView();this.onCloseDialog();e.getElementBinding().refresh(true)}})});
//# sourceMappingURL=CertificateBlockController.controller.js.map
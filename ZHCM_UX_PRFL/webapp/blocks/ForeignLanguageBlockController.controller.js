/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["com/sedef/hcm/ux/myprofile/controller/BaseController","com/sedef/hcm/ux/myprofile/utils/reuseHandler","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","com/sedef/hcm/ux/myprofile/utils/formatter"],function(e,t,o,n,a,r){"use strict";return e.extend("com.sedef.hcm.ux.myprofile.blocks.ForeignLanguageBlockController",{reuseHandler:t,formatter:r,onInit:function(){this.oApplicationController=t.getOwnerComponent().getModel("appProperties").getProperty("/applicationController");this.oODataModel=t.getOwnerComponent().getModel();var e=new a({changeRequest:{},editRequest:false,busy:false});this.setModel(e,"foreignLanguageModel");var o=sap.ui.getCore().getEventBus();o.subscribe("ForeignLanguage","Create",this.onAddForeignLanguage,this)},onAddForeignLanguage:function(){var e=this;var t=this.getModel("foreignLanguageModel");t.setProperty("/editRequest",false);t.setProperty("/changeRequest",{});var o=sap.ui.getCore().byId("idForeignLanguageChangeRequestDialog");if(o){o.destroy()}e._oForeignLanguageDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.ForeignLanguageChangeRequest",e);e.getView().addDependent(e._oForeignLanguageDialog);e._oForeignLanguageDialog.open()},onBeforeDialogOpen:function(){},onCloseDialog:function(){if(this._oForeignLanguageDialog){this._oForeignLanguageDialog.close()}},onAfterDialogClose:function(){this._oForeignLanguageDialog.destroy();delete this._oForeignLanguageDialog},onSaveChange:function(){var e=this;var a=t.getOwnerComponent().getModel("appProperties");var r=this.getModel("foreignLanguageModel");var g=this.getModel();var i=r.getProperty("/editRequest");var s={Operation:i?"MOD":"INS",OperationId:Date.now().toString(),EntityName:"ForeignLanguage",toForeignLanguage:_.cloneDeep(r.getProperty("/changeRequest")),toReturn:{}};if(!i){s.toForeignLanguage.EmployeeNumber=a.getProperty("/employeeId")}if(!s.toForeignLanguage.BeginDate){s.toForeignLanguage.BeginDate=new Date("1900-01-01");s.toForeignLanguage.EndDate=new Date("9999-12-31")}s.toForeignLanguage.BeginDate.setHours(9);s.toForeignLanguage.EndDate.setHours(9);e.setBusy(true);g.create("/InfotypeOperationSet",s,{success:function(t){if(t.toReturn.Type==="E"){n.error(t.toReturn.Message)}else{o.show("Kayıt başarılı");e._refreshProfileView()}e.setBusy(false)},error:function(t){e.setBusy(false);jQuery.sap.log.error(t)}})},onDeleteRecord:function(e){var t=e.getSource();var a=t.getBindingContext().getObject();var r=this;var g=this.getModel();var i=function(){var e={Operation:"DEL",OperationId:Date.now().toString(),EntityName:"ForeignLanguage",toForeignLanguage:_.cloneDeep(a),toReturn:{}};e.toForeignLanguage.BeginDate.setHours(9);e.toForeignLanguage.EndDate.setHours(9);r.setBusy(true);g.create("/InfotypeOperationSet",e,{success:function(e){if(e.toReturn.Type==="E"){n.error(e.toReturn.Message)}else{o.show("Kayıt silme başarılı");r._refreshProfileView()}r.setBusy(false)},error:function(e){r.setBusy(false);jQuery.sap.log.error(e)}})};var s=new sap.m.Dialog({title:"Silme Onayı",type:"Message",state:"Warning",content:new sap.m.VBox({items:[new sap.m.Text({text:"Bu işlem sonucunda kayıt silinecektir."}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Text({text:"Devam etmek istiyor musunuz?"})]}),beginButton:new sap.m.Button({type:sap.m.ButtonType.Reject,text:"Sil",press:function(){i();s.close()}}),endButton:new sap.m.Button({text:"İptal",press:function(){s.close()}}),afterClose:function(){s.destroy()}});s.open()},onEditRecord:function(e){var t=e.getSource();var o=t.getBindingContext().getObject();var n=this.getModel("foreignLanguageModel");var a=this;n.setProperty("/editRequest",true);n.setProperty("/changeRequest",_.cloneDeep(o));a._oForeignLanguageDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.ForeignLanguageChangeRequest",a);a.getView().addDependent(a._oForeignLanguageDialog);a._oForeignLanguageDialog.open()},setBusy:function(e){var t=this.getModel("foreignLanguageModel");t.setProperty("/busy",e)},_refreshProfileView:function(){var e=t.getView();this.onCloseDialog();e.getElementBinding().refresh(true)}})});
//# sourceMappingURL=ForeignLanguageBlockController.controller.js.map
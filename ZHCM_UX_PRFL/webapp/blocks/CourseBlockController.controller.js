/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["com/sedef/hcm/ux/myprofile/controller/BaseController","com/sedef/hcm/ux/myprofile/utils/reuseHandler","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","com/sedef/hcm/ux/myprofile/utils/formatter"],function(e,t,o,s,r,n){"use strict";return e.extend("com.sedef.hcm.ux.myprofile.blocks.CourseBlockController",{reuseHandler:t,formatter:n,onInit:function(){this.oApplicationController=t.getOwnerComponent().getModel("appProperties").getProperty("/applicationController");this.oODataModel=t.getOwnerComponent().getModel();var e=new r({changeRequest:{},editRequest:false,busy:false});this.setModel(e,"courseModel");var o=sap.ui.getCore().getEventBus();o.subscribe("Course","Create",this.onAddCourse,this)},onAddCourse:function(){var e=this;var t=this.getModel("courseModel");t.setProperty("/editRequest",false);t.setProperty("/changeRequest",{});var o=sap.ui.getCore().byId("idCourseChangeRequestDialog");if(o){o.destroy()}e._oCourseDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.CourseChangeRequest",e);e.getView().addDependent(e._oCourseDialog);e._oCourseDialog.open()},onBeforeDialogOpen:function(){},onCloseDialog:function(){if(this._oCourseDialog){this._oCourseDialog.close()}},onAfterDialogClose:function(){this._oCourseDialog.destroy();delete this._oCourseDialog},onSaveChange:function(){var e=this;var r=t.getOwnerComponent().getModel("appProperties");var n=this.getModel("courseModel");var a=this.getModel();var i=n.getProperty("/editRequest");var u={Operation:i?"MOD":"INS",OperationId:Date.now().toString(),EntityName:"Course",toCourse:_.cloneDeep(n.getProperty("/changeRequest")),toReturn:{}};if(!i){u.toCourse.EmployeeNumber=r.getProperty("/employeeId")}if(!u.toCourse.BeginDate){u.toCourse.BeginDate=u.toCourse.CourseDate;u.toCourse.EndDate=new Date("9999-12-31")}u.toCourse.BeginDate.setHours(9);u.toCourse.CourseDate.setHours(9);u.toCourse.EndDate.setHours(9);e.setBusy(true);a.create("/InfotypeOperationSet",u,{success:function(t){if(t.toReturn.Type==="E"){s.error(t.toReturn.Message)}else{o.show("Kayıt başarılı");e._refreshProfileView()}e.setBusy(false)},error:function(t){e.setBusy(false);jQuery.sap.log.error(t)}})},onDeleteRecord:function(e){var t=e.getSource();var r=t.getBindingContext().getObject();var n=this;var a=this.getModel();var i=function(){var e={Operation:"DEL",OperationId:Date.now().toString(),EntityName:"Course",toCourse:_.cloneDeep(r),toReturn:{}};e.toCourse.BeginDate.setHours(9);e.toCourse.EndDate.setHours(9);n.setBusy(true);a.create("/InfotypeOperationSet",e,{success:function(e){if(e.toReturn.Type==="E"){s.error(e.toReturn.Message)}else{o.show("Kayıt silme başarılı");n._refreshProfileView()}n.setBusy(false)},error:function(e){n.setBusy(false);jQuery.sap.log.error(e)}})};var u=new sap.m.Dialog({title:"Silme Onayı",type:"Message",state:"Warning",content:new sap.m.VBox({items:[new sap.m.Text({text:"Bu işlem sonucunda kayıt silinecektir."}).addStyleClass("sapUiTinyMarginBottom"),new sap.m.Text({text:"Devam etmek istiyor musunuz?"})]}),beginButton:new sap.m.Button({type:sap.m.ButtonType.Reject,text:"Sil",press:function(){i();u.close()}}),endButton:new sap.m.Button({text:"İptal",press:function(){u.close()}}),afterClose:function(){u.destroy()}});u.open()},onEditRecord:function(e){var t=e.getSource();var o=t.getBindingContext().getObject();var s=this.getModel("courseModel");var r=this;s.setProperty("/editRequest",true);s.setProperty("/changeRequest",_.cloneDeep(o));r._oCourseDialog=sap.ui.xmlfragment("com.sedef.hcm.ux.myprofile.blocks.fragments.CourseChangeRequest",r);r.getView().addDependent(r._oCourseDialog);r._oCourseDialog.open()},setBusy:function(e){var t=this.getModel("courseModel");t.setProperty("/busy",e)},_refreshProfileView:function(){var e=t.getView();this.onCloseDialog();e.getElementBinding().refresh(true)}})});
//# sourceMappingURL=CourseBlockController.controller.js.map
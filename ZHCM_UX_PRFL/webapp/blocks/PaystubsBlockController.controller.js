/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["com/sedef/hcm/ux/myprofile/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","com/sedef/hcm/ux/myprofile/utils/reuseHandler","sap/ui/Device","sap/ui/core/format/DateFormat","sap/m/GroupHeaderListItem"],function(e,t,o,s,r,a,i,n,l){"use strict";return e.extend("com.sedef.hcm.ux.myprofile.blocks.PaystubsBlockController",{onInit:function(){var e=this.byId("paystubsContainer"),n=this.byId("paystubTemplateItem"),l=this.byId("paystubListTemplate"),u=this.oView.sViewName.indexOf("PaystubsBlockCollapsed")!==-1?true:false,p=this.oView.sViewName.indexOf("PaystubsBlockExpandedList")!==-1?true:false,d=a.getOwnerComponent().getModel("appProperties"),y=d.getProperty("/applicationController"),m=y.getAppNavProperties(),g=new t({busy:false});this.setModel(g,"PaystubsView");this.oResourceBundle=a.getOwnerComponent().getModel("i18n").getResourceBundle();this.oApplicationController=y;this.sEmployeeNumber=d.getProperty("/employeeId");this.sAggregationName=i.system.phone?"pages":"content";if(u){e.addDependent(n)}if(!y.navPropertyExists(y.getAppEntities().EMPLOYEEDETAIL,m.PAYSTUBS)){sap.ui.getCore().getEventBus().subscribe("com.sedef.hcm.ux.myprofile","employeeIdChanged",this.onEmployeeIdChange,this);e.bindAggregation(this.sAggregationName,{path:"/PaystubSet",length:u?4:null,template:n,templateShareable:true,filters:new o("EmployeeNumber",s.EQ,this.sEmployeeNumber),events:{dataRequested:this.onDataRequested.bind(this),dataReceived:this.onDataReceived.bind(this)}})}else{if(!u&&p){this.byId("paystubsTable").bindItems({path:m.PAYSTUBS,template:l,sorter:new r("PayDate",true,this._oGroupFunctions.PayrollYear.bind(this)),filters:new o("EmployeeNumber",s.EQ,this.sEmployeeNumber),groupHeaderFactory:this._createGroupHeader.bind(this)})}}},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("com.sedef.hcm.ux.myprofile","employeeIdChanged",this.onEmployeeIdChange,this)},onEmployeeIdChange:function(e,t,r){var a=this.byId("paystubsContainer").getBinding(this.sAggregationName);a.filter(new o("EmployeeNumber",s.EQ,r.EmployeeId),sap.ui.model.FilterType.Application)},onDataRequested:function(){var e=this.getModel("PaystubsView");this.oApplicationController.whenMetadataLoaded(function(){e.setProperty("/busy",true)})},onDataReceived:function(e){var t=this.getModel("PaystubsView"),o=e.getParameter("data"),s=this.oApplicationController.getEmployeeDataModelForEmployeeId(this.sEmployeeNumber);s.setProperty("/bPaystubsExist",!o.results||o.results&&o.results.length===0);t.setProperty("/busy",false)},onNavToPaystubsPress:function(){this.oApplicationController.navToExternal(this.oApplicationController.getCrossAppNavIntends().PAYSTUBS.target)},formatNoPaystubsText:function(e){var t=a.getOwnerComponent().getModel("appProperties").getProperty("/oConfigData");if(t.PaystubsDuration){var o=n.getDateInstance({style:"long"}),s=a.calculateDateFromDuration(t.PaystubsDuration,"-");return jQuery.sap.formatMessage(e,[o.format(s)])}return this.oResourceBundle.getText("noPaystubsTxt")},_createGroupHeader:function(e){return new l({title:e.text,upperCase:false})},_getDefaultGroup:function(e){var t=this._oGroupFunctions.PayrollYear.bind(this);return t(e)},_oGroupFunctions:{PayrollYear:function(e){var t=e.getProperty("PayDate"),o=t.getFullYear().toString(),s=this.oResourceBundle.getText("groupingLabel",["Payroll Year",o]);return{key:o,text:s}}},_getGroup:function(e,t){var o=t.getProperty(e);var s="Payroll Year";var r=this.oResourceBundle.getText("groupingLabel",[s,o]);return{key:o,text:r}}})});
//# sourceMappingURL=PaystubsBlockController.controller.js.map
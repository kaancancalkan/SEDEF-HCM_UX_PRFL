/*
 * Copyright (C) 2009-2018 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["com/sedef/hcm/ux/myprofile/controller/BaseController","com/sedef/hcm/ux/myprofile/utils/formatter","com/sedef/hcm/ux/myprofile/utils/reuseHandler","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format","sap/ui/model/json/JSONModel","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,r,o,s,i,l,n){"use strict";return e.extend("com.sedef.hcm.ux.myprofile.blocks.SalaryBlockController",{formatter:t,onInit:function(){var e=a.getOwnerComponent().getModel("appProperties"),t=new s({busy:false});this.setModel(t,"SalaryView");this.oResourceBundle=a.getOwnerComponent().getModel("i18n").getResourceBundle();this.oApplicationController=e.getProperty("/applicationController");this.sEmployeeNumber=e.getProperty("/employeeId");sap.ui.getCore().getEventBus().subscribe("com.sedef.hcm.ux.myprofile","employeeIdChanged",this.onEmployeeIdChange,this);this._bindDataset(this.sEmployeeNumber)},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("com.sedef.hcm.ux.myprofile","employeeIdChanged",this.onEmployeeIdChange,this)},onEmployeeIdChange:function(e,t,a){this._bindDataset(a.EmployeeId)},onDataRequested:function(){var e=this.getModel("SalaryView");this.oApplicationController.whenMetadataLoaded(function(){e.setProperty("/busy",true)})},onDataReceived:function(e){var t=e.getParameter("data"),a=this.oApplicationController.getEmployeeDataModelForEmployeeId(this.sEmployeeNumber),s=this.byId("salaryVizFrame"),l=this.getModel("SalaryView"),n=this.getView().byId("idPopOver");if(!t.results||t.results&&t.results.length===0){a.setProperty("/bSalaryExists",false)}else{var u=t.results[0].Currency,d=Math.max.apply(Math,t.results.map(function(e){return parseInt(e.PayYear,10)})),p=d-1;o.numericFormatter(r.getInstance());s.removeAllFeeds();s.setVizProperties({plotArea:{dataLabel:{showTotal:false,visible:true,hideWhenOverlap:false,formatString:r.DefaultPattern.STANDARDFLOAT},dataPointStyle:{rules:[{dataContext:{GrossSalary:"*"},properties:{color:"sapUiChartPaletteQualitativeHue2"},displayName:this.oResourceBundle.getText("grossSalaryMeasure"),dataName:{GrossSalary:this.oResourceBundle.getText("grossSalaryMeasure")}},{dataContext:{NetSalary:"*"},properties:{color:"sapUiChartPaletteQualitativeHue1"},displayName:this.oResourceBundle.getText("netSalaryMeasure"),dataName:{NetSalary:this.oResourceBundle.getText("netSalaryMeasure")}}]},window:{start:{categoryAxis:{Year:p}},end:{categoryAxis:{Year:d}}}},valueAxis:{visible:true,label:{formatString:r.DefaultPattern.STANDARDFLOAT},title:{visible:false}},categoryAxis:{visible:true,title:{text:this.oResourceBundle.getText("yearDimension"),visible:true}},title:{text:this.oResourceBundle.getText("compensationTitle")+" "+"("+u+")",visible:true},interaction:{selectability:{mode:"exclusive",legendSelection:false,axisLabelSelection:false,plotLassoSelection:false,plotStdSelection:true}}});var m=new i({uid:"valueAxis",type:"Measure",values:["GrossSalary","NetSalary"]}),y=new i({uid:"categoryAxis",type:"Dimension",values:["Year"]});s.addFeed(m);s.addFeed(y);n.setFormatString(r.DefaultPattern.STANDARDFLOAT);n.connect(s.getVizUid());a.setProperty("/bSalaryExists",true)}l.setProperty("/busy",false)},formatNoSalaryText:function(e){var t=a.getOwnerComponent().getModel("appProperties").getProperty("/oConfigData");if(t.SalaryDuration){return jQuery.sap.formatMessage(e,[t.SalaryDuration.DurationYears])}return this.oResourceBundle.getText("noSalaryTxt")},_bindDataset:function(e){this.byId("dataset").bindData({path:"/CompensationSet",filters:new l("EmployeeNumber",n.EQ,e),events:{dataRequested:this.onDataRequested.bind(this),dataReceived:this.onDataReceived.bind(this)}})}})});
//# sourceMappingURL=SalaryBlockController.controller.js.map